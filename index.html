<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="description" content="Nelma Modas Oficial - Moda Feminina com Elegância e Estilo" />
  <title>NELMA MODAS OFICIAL</title>
  <link rel="icon" href="https://nelma-modas-oficial.web.app/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{background:#e87474;color:#fff;overflow-x:hidden;padding-bottom:300px;transition:all 0.4s ease;}
    header{background:#ef8184;text-align:center;padding:20px 0;font-size:28px;font-weight:600;letter-spacing:2px;transition:background 0.4s ease;}
    header span{display:block;font-size:16px;font-weight:300;}
    .banner-container{width:100%;overflow:hidden;position:relative;margin-bottom:20px;}
    .banner-slide{display:flex;transition:transform 0.5s ease;touch-action: pan-y;}
    .banner-slide img{width:100%;height:300px;object-fit:cover;loading:lazy;}
    .products-wrapper{position:relative;margin:0 30px;}
    .products{display:flex;gap:20px;overflow-x:auto;scroll-behavior:smooth;cursor:grab;padding-bottom:10px;-webkit-overflow-scrolling:touch;}
    .product{flex:0 0 300px;background-color:#ffffff22;border-radius:15px;padding:15px;text-align:center;transition:transform 0.3s;position:relative;opacity:0;transform:translateY(20px);}
    .product.visible{opacity:1;transform:translateY(0);transition: all 0.5s ease;}
    .product:hover{transform:scale(1.05);background-color:#ffffff33;}
    .product img{width:100%;height:300px;object-fit:cover;border-radius:12px;cursor:pointer;loading:lazy;}
    .product h3{font-size:20px;margin:10px 0 5px;color:#fff;}
    .status{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:8px;font-size:14px;font-weight:600;color:#000;}
    .status.disponivel{background-color:#32CD32;}
    .status.sobpedido{background-color:#FF6347;}
    .size-options{display:flex;justify-content:center;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
    .size-btn{background-color:#ffffff44;color:#fff;border:none;border-radius:10px;padding:8px 16px;cursor:pointer;transition:0.3s;font-weight:500;}
    .size-btn:hover{background-color:#ffffff66;}
    .size-btn.selected{background-color:#1e90ff;color:#fff;}
    .btns{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-bottom:10px;}
    .btn{background-color:#1e90ff;color:#fff;border:none;border-radius:25px;padding:12px 20px;cursor:pointer;transition:0.3s;font-weight:500;}
    .btn:hover{background-color:#3aa1ff;}
    .btn-whatsapp{background-color:#25D366 !important;}
    .btn-whatsapp:hover{background-color:#1ebe57 !important;}
    .product-nav{display:flex;justify-content:center;gap:15px;margin:10px 0;}
    .product-nav button{padding:8px 16px;border-radius:10px;border:none;background:#1e90ff;color:#fff;cursor:pointer;transition:0.3s;}
    .product-nav button:hover{background:#3aa1ff;}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:2000;}
    .modal-content{background:#fff;color:#000;padding:20px;border-radius:12px;max-width:800px;width:90%;max-height:90%;overflow-y:auto;text-align:center;}
    #detailImages{display:flex;gap:10px;overflow-x:auto;margin-top:10px;}
    #detailImages img{height:80px;border-radius:5px;object-fit:cover;cursor:pointer;loading:lazy;}
    #detailMainImage{max-height:400px;border-radius:10px;object-fit:cover;margin:10px 0;cursor:zoom-in;transition:transform 0.3s ease;loading:lazy;}
    #detailMainImage.zoomed{transform:scale(2);cursor:zoom-out;}
    #adminBtn{position:fixed;bottom:20px;right:20px;background:linear-gradient(135deg, #1e90ff, #00bfff);color:#fff;border:none;border-radius:50%;width:60px;height:60px;font-size:24px;cursor:pointer;z-index:3000;box-shadow:0 6px 15px rgba(0,0,0,0.3);transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;}
    #adminBtn:hover{transform:scale(1.1) rotate(90deg);box-shadow:0 10px 20px rgba(0,0,0,0.4);background:linear-gradient(135deg, #00bfff, #1e90ff);}
    #instaFloatBtn {position: fixed;bottom: 90px;left: 20px;background: linear-gradient(135deg, #E4405F, #C13584);color: #fff;width: 60px;height: 60px;border-radius: 50%;display: flex;align-items: center;justify-content: center;font-size: 28px;box-shadow: 0 6px 15px rgba(0,0,0,0.3);z-index: 3000;transition: all 0.3s ease;text-decoration: none;}
    #instaFloatBtn:hover {transform: scale(1.1);box-shadow: 0 10px 20px rgba(0,0,0,0.4);}
    #adminPanel{display:none;position:fixed;bottom:90px;right:20px;background-color:#ef8184;color:#fff;padding:18px;border-radius:18px;width:340px;max-height:80vh;overflow-y:auto;z-index:3000;box-shadow:0 10px 30px rgba(0,0,0,0.3);}
    #adminPanel input,#adminPanel select,#adminPanel button,#adminPanel textarea{width:100%;margin-bottom:10px;padding:10px;border-radius:10px;border:none;font-size:14px;}
    #adminPanel button{background:#1e90ff;color:#fff;font-weight:600;cursor:pointer;}
    #adminPanel button:hover{background:#3aa1ff;}
    .admin-product,.admin-banner{background-color:#ffffff22;padding:8px;margin-bottom:8px;border-radius:10px;font-size:14px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:5px;}
    .admin-product input, .admin-product select{width:48%;}
    .admin-product button{width:48%;font-size:12px;padding:8px;}
    .admin-banner img{max-height:50px;border-radius:5px;}
    .admin-banner button{background:#e74c3c;color:#fff;border:none;padding:5px 10px;border-radius:8px;font-size:12px;cursor:pointer;}
    .admin-banner button:hover{background:#c0392b;}
    footer{background:#ef8184;text-align:center;padding:15px;font-size:15px;color:#fff;margin-top:20px;transition:background 0.4s ease;}
    footer a{color:#fff;text-decoration:none;font-weight:bold;}
    footer a:hover{text-decoration:underline;}
    #loadingScreen {position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: #ef8184;display: flex;align-items: center;justify-content: center;z-index: 4000;transition: opacity 0.5s ease;}
    .loader {
      text-align: center;
      color: #fff;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .logo-text {font-size: 48px; font-weight: 600; letter-spacing: 3px; margin-bottom: 20px; opacity: 0; animation: fadeInUp 0.8s ease forwards;}
    .dots {display: flex; justify-content: center; gap: 8px;}
    .dots span {width: 12px; height: 12px; background: #fff; border-radius: 50%; display: inline-block; animation: pulse 1.4s infinite ease-in-out;}
    .dots span:nth-child(1) { animation-delay: 0s; }
    .dots span:nth-child(2) { animation-delay: 0.2s; }
    .dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 60%, 100% { transform: scale(1); opacity: 0.6; } 40% { transform: scale(1.4); opacity: 1; } }
    .color-picker-group {margin-bottom: 12px;text-align: left;}
    .color-picker-group label {display: block;margin-bottom: 5px;font-weight: 600;font-size: 14px;}
    .color-picker-group input[type="color"] {width: 100%;height: 40px;border: none;border-radius: 8px;cursor: pointer;}
    #saveThemeBtn {background: #27ae60 !important;margin-top: 10px;}
    #saveThemeBtn:hover {background: #1e8449 !important;}
    .password-container {position: relative;display: flex;align-items: center;margin-bottom: 10px;}
    #adminPassword {width: calc(100% - 80px);margin-right: 5px;}
    #togglePassword {width: 70px;padding: 10px;background: #1e90ff;color: #fff;border: none;border-radius: 10px;cursor: pointer;font-size: 12px;white-space: nowrap;}
    #togglePassword:hover {background: #3aa1ff;}
    .crop-image-cropper {margin: 15px 0;padding: 12px;background: #ffffff22;border-radius: 12px;display: none;border: 1px solid #ffffff44;}
    .cropper-container {max-height: 320px;margin: 12px 0;border-radius: 8px;overflow: visible !important;position: relative;}
    .cropper-container img {max-width: 100%;display: block;}
    .cropper-actions {display: flex;gap: 8px;flex-wrap: wrap;margin-top: 10px;}
    .cropper-actions button {flex: 1;min-width: 100px;font-weight: 600;}
    #croppedUrlOutput {width: 100%;padding: 8px;background: #00000066;color: #fff;border: 1px solid #ffffff44;border-radius: 8px;font-size: 11px;word-break: break-all;margin-top: 8px;display: none;}
    #cropStatus {font-weight: 600;margin-top: 5px;}
    @keyframes fadeInMsg { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

    /* === CORREÇÃO: BOTÕES NO LOADING === */
    #adminBtn,
    #instaFloatBtn,
    .products-wrapper,
    .banner-container,
    header,
    footer,
    [style*="text-align:center; margin:20px;"] {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease;
    }
    body.loaded #adminBtn,
    body.loaded #instaFloatBtn,
    body.loaded .products-wrapper,
    body.loaded .banner-container,
    body.loaded header,
    body.loaded footer,
    body.loaded [style*="text-align:center; margin:20px;"] {
      opacity: 1;
      visibility: visible;
    }

    @media(max-width:768px){
      .banner-slide img{height:200px;}
      .product{flex:0 0 220px;}
      .product img{height:200px;}
      #adminBtn{width:55px;height:55px;font-size:22px;bottom:15px;right:15px;}
      #adminPanel{width:300px;bottom:80px;right:15px;}
      #instaFloatBtn{width:55px;height:55px;font-size:24px;bottom:80px;left:15px;}
      .logo-text{font-size:36px;}
      .admin-product input, .admin-product select, .admin-product button{width:100%;margin-bottom:5px;}
      .password-container { flex-direction: column; }
      #adminPassword { width: 100%; margin-right: 0; margin-bottom: 5px; }
      #togglePassword { width: 100%; }
      .cropper-actions { flex-direction: column; }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
</head>
<body>
  <div id="loadingScreen">
    <div class="loader">
      <div class="logo-text">NELMA</div>
      <div class="dots">
        <span></span><span></span><span></span>
      </div>
    </div>
  </div>
  <header>
    NELMA MODAS OFICIAL
    <span>Moda Feminina e Elegância</span>
  </header>
  <div class="banner-container">
    <div class="banner-slide" id="bannerSlide"></div>
  </div>
  <div style="text-align:center; margin:20px;">
    <input type="text" id="searchInput" placeholder="Buscar por nome..." aria-label="Buscar produto">
    <select id="statusFilter" aria-label="Filtrar por status">
      <option value="">Todos os status</option>
      <option value="disponivel">Disponível</option>
      <option value="sobpedido">Sob Pedido</option>
    </select>
  </div>
  <div class="products-wrapper">
    <div class="products" id="productList"></div>
    <div class="product-nav">
      <button id="prevProduct" aria-label="Produto anterior">Anterior</button>
      <button id="nextProduct" aria-label="Próximo produto">Próximo</button>
    </div>
  </div>
  <div class="modal" id="detailModal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <button class="btn" id="closeModalBtn" onclick="closeDetailModal()" aria-label="Fechar">Fechar</button>
      <h2 id="detailTitle"></h2>
      <p id="detailStatus" style="font-weight:bold;"></p>
      <img id="detailMainImage" src="" alt="Imagem principal do produto">
      <div id="detailImages" role="group" aria-label="Miniaturas"></div>
    </div>
  </div>
  <button id="adminBtn" title="Painel Admin" aria-label="Abrir painel administrativo">
    <i class="fas fa-cog"></i>
  </button>
  <a href="https://instagram.com/nelmamodasoficial" target="_blank" id="instaFloatBtn" title="Siga no Instagram" aria-label="Instagram">
    <i class="fab fa-instagram"></i>
  </a>
  <div id="adminPanel" style="display:none;">
    <h3>Login Admin</h3>
    <div class="password-container">
      <input type="password" id="adminPassword" placeholder="Senha">
      <button type="button" id="togglePassword">Mostrar</button>
    </div>
    <button id="loginBtn">Entrar</button>
    <div id="adminContent" style="display:none;">
      <!-- EDITOR DE CÓDIGO -->
      <div style="margin:20px 0;padding:15px;background:#1e90ff22;border-radius:12px;">
        <h3 style="color:#fff;margin:0 0 10px;">Editor de Código (HTML/CSS/JS)</h3>
        <div style="display:flex;gap:5px;margin-bottom:10px;">
          <button id="loadCodeBtn" class="btn" style="background:#27ae60;flex:1;">Carregar Código Atual</button>
          <button id="testCodeBtn" class="btn" style="background:#9b59b6;flex:1;">TESTAR EM NOVA ABA</button>
        </div>
        <textarea id="codeEditor" placeholder="Cole ou edite o código aqui..." style="width:100%;height:300px;font-family:monospace;font-size:12px;background:#000;color:#0f0;padding:10px;border-radius:8px;border:1px solid #fff4;resize:vertical;"></textarea>
        <div style="display:flex;gap:5px;margin-top:10px;">
          <input type="text" id="newVersionNum" placeholder="Versão (ex: 1.2)" style="flex:1;">
          <input type="text" id="newVersionName" placeholder="Nome da versão" style="flex:1;">
        </div>
        <textarea id="versionChanges" placeholder="O que mudou?" style="width:100%;height:50px;margin-top:5px;font-size:12px;"></textarea>
        <button id="publishCodeBtn" class="btn" style="background:#e67e22;margin-top:10px;width:100%;">PUBLICAR NOVA VERSÃO</button>
        <p id="codeStatus" style="margin:8px 0 0;font-size:13px;color:#ff0;"></p>
      </div>

      <h3>Adicionar Produto</h3>
      <input type="text" id="productName" placeholder="Nome do Produto">
      <select id="productStatus">
        <option value="disponivel">Disponível</option>
        <option value="sobpedido">Sob Pedido</option>
      </select>
      <input type="text" id="productSizes" placeholder="Tamanhos (P,M,G)">
      <input type="text" id="mainImageURL" placeholder="URL da Imagem Principal">
      <div class="crop-image-cropper" id="imageCropper">
        <p><strong>Ferramenta de Corte</strong> (3:4)</p>
        <input type="text" id="cropImageInput" placeholder="Cole a URL da imagem aqui" style="margin-bottom:8px;">
        <button type="button" id="loadCropImage" class="btn" style="background:#27ae60;margin-bottom:8px;">Carregar</button>
        <div class="cropper-container" id="cropperContainer">
          <img id="cropImage" src="" alt="Imagem para corte">
        </div>
        <div class="cropper-actions">
          <button type="button" id="cropDone" class="btn" style="background:#1e90ff;">Cortar</button>
          <button type="button" id="cropCancel" class="btn" style="background:#e74c3c;">Cancelar</button>
        </div>
        <input type="text" id="croppedUrlOutput" placeholder="URL cortada aparecerá aqui" readonly>
        <button type="button" id="copyCroppedUrl" class="btn" style="background:#27ae60;margin-top:5px;display:none;">Copiar</button>
        <p id="cropStatus" style="font-size:12px;color:#ff0;margin-top:5px;display:none;"></p>
      </div>
      <button type="button" id="openCropTool" class="btn" style="background:#9b59b6;margin-bottom:10px;">Abrir Corte</button>
      <input type="text" id="detailImagesURL" placeholder="URLs detalhes (vírgula)">
      <button id="addProductBtn">Adicionar</button>
      <h3>Gerenciar Banner</h3>
      <input type="text" id="bannerImagesURL" placeholder="Novas URLs">
      <button id="updateBannerBtn">Atualizar</button>
      <h4>Banners Atuais</h4>
      <div id="adminBanners"></div>
      <h3>Personalizar Cores</h3>
      <div class="color-picker-group"><label>Fundo do Site</label><input type="color" id="colorBodyBg" value="#e87474"></div>
      <div class="color-picker-group"><label>Cabeçalho</label><input type="color" id="colorHeaderBg" value="#ef8184"></div>
      <div class="color-picker-group"><label>Botões</label><input type="color" id="colorButtonBg" value="#1e90ff"></div>
      <div class="color-picker-group"><label>Admin</label><input type="color" id="colorAdminBg" value="#ef8184"></div>
      <div class="color-picker-group"><label>Disponível</label><input type="color" id="colorDisponivelBg" value="#32CD32"></div>
      <div class="color-picker-group"><label>Sob Pedido</label><input type="color" id="colorSobpedidoBg" value="#FF6347"></div>
      <button id="saveThemeBtn">Salvar Cores</button>
      <h3>Gerenciar Produtos</h3>
      <div id="adminProducts"></div>
      <button id="logoutBtn" style="background:#e74c3c;margin-top:10px;">Sair</button>
    </div>
  </div>
  <footer>
    <p>Siga-nos no Instagram: <a href="https://instagram.com/nelmamodasoficial" target="_blank">@nelmamodasoficial</a></p>
    <p>© 2025 NELMA MODAS OFICIAL - Todos os direitos reservados.<span id="footerVersion"></span></p>
  </footer>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCO3F1Garczz-1TchO6zm-H3olFGL8TbEo",
      authDomain: "nelma-modas-oficial.firebaseapp.com",
      projectId: "nelma-modas-oficial",
      storageBucket: "nelma-modas-oficial.appspot.com",
      messagingSenderId: "171368002339",
      appId: "1:171368002339:web:8a279e85ffe64cf8749296"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const loadingScreen = document.getElementById('loadingScreen');
    let loaded = false;

    // === CORREÇÃO: ATIVAR BOTÕES APÓS LOADING ===
    function hideLoading() {
      if (loaded) return;
      loaded = true;
      loadingScreen.style.opacity = '0';
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        document.body.classList.add('loaded'); // Mostra tudo
      }, 500);
    }
    setTimeout(hideLoading, 6000);
    loadingScreen.addEventListener('click', hideLoading);

    let theme = { bodyBg: '#e87474', headerBg: '#ef8184', buttonBg: '#1e90ff', adminBg: '#ef8184', disponivelBg: '#32CD32', sobpedidoBg: '#FF6347', sizeBtnBg: '#ffffff44', sizeBtnText: '#ffffff', productName: '#ffffff', productCardBg: '#ffffff22', closeBtnBg: '#1e90ff' };
    function applyTheme() {
      document.body.style.backgroundColor = theme.bodyBg;
      document.querySelector('header').style.backgroundColor = theme.headerBg;
      document.querySelector('footer').style.backgroundColor = theme.headerBg;
      document.getElementById('adminPanel').style.backgroundColor = theme.adminBg;
      document.getElementById('closeModalBtn').style.backgroundColor = theme.closeBtnBg;
      document.querySelectorAll('.btn, .product-nav button, #saveThemeBtn').forEach(btn => { if (!btn.classList.contains('btn-whatsapp')) btn.style.backgroundColor = theme.buttonBg; });
      document.querySelectorAll('.status.disponivel').forEach(el => el.style.backgroundColor = theme.disponivelBg);
      document.querySelectorAll('.status.sobpedido').forEach(el => el.style.backgroundColor = theme.sobpedidoBg);
      document.querySelectorAll('.size-btn').forEach(btn => { btn.style.backgroundColor = theme.sizeBtnBg; btn.style.color = theme.sizeBtnText; });
      document.querySelectorAll('.size-btn.selected').forEach(btn => { btn.style.backgroundColor = theme.buttonBg; btn.style.color = '#fff'; });
      document.querySelectorAll('.product h3').forEach(h3 => h3.style.color = theme.productName);
      document.querySelectorAll('.product').forEach(card => card.style.backgroundColor = theme.productCardBg);
      const hoverColor = lightenColor(theme.buttonBg, 20);
      const closeHover = lightenColor(theme.closeBtnBg, 20);
      let style = document.getElementById('dynamic-styles');
      if (!style) { style = document.createElement('style'); style.id = 'dynamic-styles'; document.head.appendChild(style); }
      style.textContent = `.btn:not(.btn-whatsapp):hover, .product-nav button:hover, #saveThemeBtn:hover { background-color: ${hoverColor} !important; } #closeModalBtn:hover { background-color: ${closeHover} !important; } .size-btn:hover { background-color: ${lightenColor(theme.sizeBtnBg, 20)} !important; }`;
    }
    function lightenColor(hex, percent) {
      const num = parseInt(hex.replace("#", ""), 16), amt = Math.round(2.55 * percent),
            R = (num >> 16) + amt, G = (num >> 8 & 0x00FF) + amt, B = (num & 0x0000FF) + amt;
      return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }
    db.collection('config').doc('theme').onSnapshot(doc => { if (doc.exists) { theme = { ...theme, ...doc.data() }; applyTheme(); if (document.getElementById('adminContent').style.display === 'block') updateColorPickers(); } });
    function updateColorPickers() { Object.keys(theme).forEach(key => { const el = document.getElementById('color' + key.charAt(0).toUpperCase() + key.slice(1)); if (el) el.value = theme[key]; }); }
    document.getElementById('saveThemeBtn').onclick = async () => { Object.keys(theme).forEach(key => { const el = document.getElementById('color' + key.charAt(0).toUpperCase() + key.slice(1)); if (el) theme[key] = el.value; }); await db.collection('config').doc('theme').set(theme); alert('Cores salvas!'); applyTheme(); };

    let bannerImages = [];
    const bannerSlide = document.getElementById('bannerSlide');
    let bannerInterval;
    function renderBanner() {
      bannerSlide.innerHTML = '';
      bannerImages.forEach(url => {
        const img = document.createElement('img'); img.src = url; img.alt = "Banner"; img.loading = "lazy";
        img.onerror = () => img.src = "https://via.placeholder.com/1200x300/ef8184/ffffff?text=Banner+Indispon%C3%ADvel";
        bannerSlide.appendChild(img);
      });
      bannerSlide.style.transform = 'translateX(0)';
      if (bannerInterval) clearInterval(bannerInterval);
      if (bannerImages.length > 1) {
        let i = 0;
        bannerInterval = setInterval(() => { i = (i + 1) % bannerImages.length; bannerSlide.style.transform = `translateX(${-i * 100}%)`; }, 5000);
      }
    }
    db.collection('banners').doc('current').onSnapshot(doc => { bannerImages = doc.exists && doc.data().urls?.length ? doc.data().urls : ["https://via.placeholder.com/1200x300/ef8184/ffffff?text=Nelma+Modas"]; renderBanner(); updateAdminBannersList(); });

    let productsData = [];
    const productList = document.getElementById('productList');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    function filterAndRender() {
      const search = searchInput.value.toLowerCase().trim();
      const status = statusFilter.value;
      const filtered = productsData.filter(p => p.nome.toLowerCase().includes(search) && (!status || p.status === status));
      productList.innerHTML = '';
      filtered.forEach((p, i) => {
        const div = document.createElement('div'); div.className = 'product'; setTimeout(() => div.classList.add('visible'), i * 100);
        const tamanhos = Array.isArray(p.tamanhos) ? p.tamanhos : [];
        const sizeBtns = tamanhos.map(t => `<button class="size-btn" onclick="this.parentElement.querySelectorAll('.size-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')">${t}</button>`).join('');
        const safeImg = p.mainImage?.startsWith('http') || p.mainImage?.startsWith('data:') ? p.mainImage : 'https://via.placeholder.com/600x800?text=Sem+Imagem';
        const msg = encodeURIComponent(`Olá! Gostaria de saber sobre: *${p.nome}*`);
        div.innerHTML = `<span class="status ${p.status}">${p.status === 'disponivel' ? 'Disponível' : 'Sob Pedido'}</span>
          <img src="${safeImg}" alt="${p.nome}" onclick="openDetailModal('${p._id}')" loading="lazy">
          <h3>${p.nome}</h3>
          <div class="size-options">${sizeBtns}</div>
          <div class="btns">
            <a href="https://wa.me/5594992936856?text=${msg}" target="_blank">
              <button class="btn btn-whatsapp">WhatsApp</button>
            </a>
          </div>`;
        productList.appendChild(div);
      });
      applyTheme();
    }
    db.collection('produtos').orderBy('nome').onSnapshot(snap => { productsData = snap.docs.map(doc => ({ ...doc.data(), _id: doc.id })); filterAndRender(); updateAdminProductsList(); hideLoading(); });
    searchInput.addEventListener('input', filterAndRender);
    statusFilter.addEventListener('change', filterAndRender);

    window.openDetailModal = function(id) {
      const p = productsData.find(x => x._id === id);
      if (!p) return;
      document.getElementById('detailTitle').textContent = p.nome;
      const statusEl = document.getElementById('detailStatus'); statusEl.textContent = p.status === 'disponivel' ? 'Disponível' : 'Sob Pedido'; statusEl.className = p.status;
      const images = p.detailImages?.length ? p.detailImages : [p.mainImage];
      const mainImg = document.getElementById('detailMainImage'); mainImg.src = images[0]; mainImg.alt = p.nome;
      const thumbs = document.getElementById('detailImages'); thumbs.innerHTML = '';
      images.forEach((url, i) => { const img = document.createElement('img'); img.src = url; img.alt = `Detalhe ${i+1}`; img.onclick = () => mainImg.src = url; thumbs.appendChild(img); });
      document.getElementById('detailModal').style.display = 'flex'; applyTheme();
    };
    window.closeDetailModal = () => { document.getElementById('detailModal').style.display = 'none'; document.getElementById('detailMainImage').classList.remove('zoomed'); };
    document.getElementById('detailMainImage').onclick = e => e.target.classList.toggle('zoomed');
    document.getElementById('prevProduct').onclick = () => productList.scrollBy({ left: -300, behavior: 'smooth' });
    document.getElementById('nextProduct').onclick = () => productList.scrollBy({ left: 300, behavior: 'smooth' });

    const adminBtn = document.getElementById('adminBtn');
    const adminPanel = document.getElementById('adminPanel');
    const adminContent = document.getElementById('adminContent');
    const loginBtn = document.getElementById('loginBtn');
    const adminPassword = document.getElementById('adminPassword');
    const logoutBtn = document.getElementById('logoutBtn');
    adminBtn.onclick = () => { adminPanel.style.display = adminPanel.style.display === 'block' ? 'none' : 'block'; if (adminPanel.style.display === 'block') adminPassword.focus(); };

    // SENHA COM .trim()
    loginBtn.onclick = () => {
      const senha = adminPassword.value.trim();
      if (senha === 'braga240895') {
        adminContent.style.display = 'block';
        loginBtn.style.display = 'none';
        adminPassword.style.display = 'none';
        document.getElementById('togglePassword').style.display = 'none';
        updateAdminBannersList();
        updateAdminProductsList();
        updateColorPickers();
        applyTheme();
      } else {
        alert('Senha incorreta');
      }
    };

    logoutBtn.onclick = () => { adminContent.style.display = 'none'; loginBtn.style.display = 'block'; adminPassword.style.display = 'block'; document.getElementById('togglePassword').style.display = 'block'; adminPassword.value = ''; };
    document.getElementById('togglePassword').onclick = () => { const p = document.getElementById('adminPassword'); const b = document.getElementById('togglePassword'); p.type = p.type === 'password' ? 'text' : 'password'; b.textContent = p.type === 'password' ? 'Mostrar' : 'Esconder'; };

    let cropper = null;
    const cropTool = document.getElementById('imageCropper');
    const openCropBtn = document.getElementById('openCropTool');
    const loadBtn = document.getElementById('loadCropImage');
    const cropBtn = document.getElementById('cropDone');
    const cancelBtn = document.getElementById('cropCancel');
    const cropInput = document.getElementById('cropImageInput');
    const cropImage = document.getElementById('cropImage');
    const outputField = document.getElementById('croppedUrlOutput');
    const copyBtn = document.getElementById('copyCroppedUrl');
    const statusText = document.getElementById('cropStatus');
    openCropBtn.onclick = () => { cropTool.style.display = cropTool.style.display === 'block' ? 'none' : 'block'; if (cropTool.style.display === 'block') cropInput.focus(); };
    loadBtn.onclick = () => { const url = cropInput.value.trim(); if (!url || !url.startsWith('http')) return alert('URL inválida'); statusText.textContent = 'Carregando...'; statusText.style.display = 'block'; statusText.style.color = '#ff0'; cropImage.src = url + '?t=' + Date.now(); cropImage.onload = () => { statusText.textContent = 'Arraste para cortar'; statusText.style.color = '#0f0'; if (cropper) cropper.destroy(); cropper = new Cropper(cropImage, { aspectRatio: 3/4, viewMode: 1, dragMode: 'move', autoCropArea: 0.85, restore: false, guides: true, center: true, highlight: true, cropBoxMovable: true, cropBoxResizable: true, toggleDragModeOnDblclick: false }); }; cropImage.onerror = () => { statusText.textContent = 'Erro ao carregar'; statusText.style.color = '#f00'; }; };
    cropBtn.onclick = () => { if (!cropper) return alert('Carregue uma imagem'); statusText.textContent = 'Cortando...'; statusText.style.color = '#ff0'; try { const canvas = cropper.getCroppedCanvas({ width: 600, height: 800, imageSmoothingEnabled: true, imageSmoothingQuality: 'high' }); const dataUrl = canvas.toDataURL('image/jpeg', 0.92); outputField.value = dataUrl; outputField.style.display = 'block'; copyBtn.style.display = 'block'; document.getElementById('mainImageURL').value = dataUrl; statusText.textContent = 'Corte concluído!'; statusText.style.color = '#0f0'; } catch (e) { statusText.textContent = 'Erro: ' + e.message; statusText.style.color = '#f00'; } };
    cancelBtn.onclick = () => { if (cropper) { cropper.destroy(); cropper = null; } cropImage.src = ''; outputField.style.display = 'none'; copyBtn.style.display = 'none'; outputField.value = ''; statusText.style.display = 'none'; };
    copyBtn.onclick = () => { outputField.select(); document.execCommand('copy'); alert('Copiado!'); };

    document.getElementById('addProductBtn').onclick = async () => {
      const nome = document.getElementById('productName').value.trim();
      const status = document.getElementById('productStatus').value;
      const tamanhos = document.getElementById('productSizes').value.split(',').map(s => s.trim()).filter(Boolean);
      const mainImage = document.getElementById('mainImageURL').value.trim();
      const detailImages = document.getElementById('detailImagesURL').value.split(',').map(s => s.trim()).filter(s => s.startsWith('http') || s.startsWith('data:'));
      if (!nome || !mainImage) return alert('Preencha nome e imagem');
      await db.collection('produtos').add({ nome, status, tamanhos, mainImage, detailImages, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
      alert('Produto adicionado!'); ['productName','productSizes','mainImageURL','detailImagesURL'].forEach(id => document.getElementById(id).value = ''); if (cropper) { cropper.destroy(); cropper = null; } cropTool.style.display = 'none';
    };
    document.getElementById('updateBannerBtn').onclick = async () => {
      const urls = document.getElementById('bannerImagesURL').value.split(',').map(s => s.trim()).filter(s => s.startsWith('http') || s.startsWith('data:'));
      if (!urls.length) return alert('Insira ao menos uma URL');
      await db.collection('banners').doc('current').set({ urls }, { merge: true });
      alert('Banner atualizado!'); document.getElementById('bannerImagesURL').value = '';
    };
    function updateAdminBannersList() {
      const container = document.getElementById('adminBanners'); container.innerHTML = '';
      bannerImages.forEach((url, i) => { const div = document.createElement('div'); div.className = 'admin-banner'; div.innerHTML = `<img src="${url}" alt="Banner ${i+1}" onerror="this.src='https://via.placeholder.com/100x50?text=Erro'"> <button onclick="deleteBanner(${i})">Excluir</button>`; container.appendChild(div); });
    }
    window.deleteBanner = async (i) => { if (!confirm('Excluir?')) return; const newUrls = bannerImages.filter((_, idx) => idx !== i); if (newUrls.length) await db.collection('banners').doc('current').set({ urls: newUrls }); else await db.collection('banners').doc('current').delete(); };
    function updateAdminProductsList() {
      const container = document.getElementById('adminProducts'); container.innerHTML = '';
      productsData.forEach(p => {
        const div = document.createElement('div'); div.className = 'admin-product';
        div.innerHTML = `<input type="text" value="${p.nome}" id="editName_${p._id}" placeholder="Nome">
          <select id="editStatus_${p._id}"><option value="disponivel" ${p.status === 'disponivel' ? 'selected' : ''}>Disponível</option><option value="sobpedido" ${p.status === 'sobpedido' ? 'selected' : ''}>Sob Pedido</option></select>
          <input type="text" value="${Array.isArray(p.tamanhos) ? p.tamanhos.join(', ') : ''}" id="editSizes_${p._id}" placeholder="P, M, G">
          <button onclick="saveProduct('${p._id}')">Salvar</button>
          <button style="background:#e74c3c;" onclick="deleteProduct('${p._id}', '${p.nome}')">Excluir</button>`;
        container.appendChild(div);
      });
    }
    window.saveProduct = async (id) => { const nome = document.getElementById(`editName_${id}`).value.trim(); const status = document.getElementById(`editStatus_${id}`).value; const tamanhos = document.getElementById(`editSizes_${id}`).value.split(',').map(s => s.trim()).filter(Boolean); if (!nome) return alert('Nome obrigatório'); await db.collection('produtos').doc(id).update({ nome, status, tamanhos }); alert('Atualizado!'); };
    window.deleteProduct = async (id, nome) => { if (confirm(`Excluir "${nome}"?`)) await db.collection('produtos').doc(id).delete(); };

    // === EDITOR DE CÓDIGO NO ADMIN ===
    let currentSiteCode = '';
    document.getElementById('loadCodeBtn').onclick = () => {
      currentSiteCode = document.documentElement.outerHTML;
      document.getElementById('codeEditor').value = currentSiteCode;
      document.getElementById('codeStatus').textContent = 'Código carregado!';
      document.getElementById('codeStatus').style.color = '#0f0';
    };

    document.getElementById('testCodeBtn').onclick = () => {
      const code = document.getElementById('codeEditor').value;
      if (!code.trim()) return alert('Código vazio');
      const blob = new Blob([code], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(() => URL.revokeObjectURL(url), 60000);
      document.getElementById('codeStatus').textContent = 'Teste aberto!';
      document.getElementById('codeStatus').style.color = '#0f0';
    };

    document.getElementById('publishCodeBtn').onclick = async () => {
      const code = document.getElementById('codeEditor').value.trim();
      const num = document.getElementById('newVersionNum').value.trim();
      const name = document.getElementById('newVersionName').value.trim();
      const changes = document.getElementById('versionChanges').value.trim();
      const status = document.getElementById('codeStatus');

      if (!code || !num || !name || !changes) {
        status.textContent = 'Preencha todos os campos!';
        status.style.color = '#f00';
        return;
      }

      status.textContent = 'Publicando v' + num + '...';
      status.style.color = '#ff0';

      try {
        const versionRef = await db.collection('siteVersions').add({
          number: num,
          name: name,
          changes: changes,
          html: code,
          publishedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        await db.collection('config').doc('currentVersion').set({
          id: versionRef.id,
          number: num,
          name: name,
          changes: changes
        });

        status.textContent = `v${num} publicada! Recarregue o site.`;
        status.style.color = '#0f0';

        document.getElementById('newVersionNum').value = '';
        document.getElementById('newVersionName').value = '';
        document.getElementById('versionChanges').value = '';

        setTimeout(() => {
          if (confirm(`v${num} publicada! Recarregar agora?`)) {
            localStorage.setItem('siteVersion', num);
            location.reload();
          }
        }, 1000);
      } catch (e) {
        status.textContent = 'Erro: ' + e.message;
        status.style.color = '#f00';
      }
    };

    // === CARREGA VERSÃO DO FIRESTORE ===
    db.collection('config').doc('currentVersion').onSnapshot(async doc => {
      if (doc.exists) {
        const data = doc.data();
        const saved = localStorage.getItem('siteVersion');
        if (saved !== data.number) {
          const versionDoc = await db.collection('siteVersions').doc(data.id).get();
          if (versionDoc.exists && versionDoc.data().html) {
            const msg = `Nova versão v${data.number}!\n\n${data.name}\n${data.changes}\n\nRecarregar?`;
            if (confirm(msg)) {
              document.open();
              document.write(versionDoc.data().html);
              document.close();
              localStorage.setItem('siteVersion', data.number);
            }
          }
        }
      }
    });

    applyTheme();
  </script>
</body>
</html>